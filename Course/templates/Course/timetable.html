<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>M&C - Занятия, расписание занятий</title>
    <!-- Bootstrap CSS (jsDelivr CDN) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
<body>
{% include 'template/flash_message.html'%}
{% include 'template/base_head.html' %}

{% include 'template/header.html' %}

<!-- Bootstrap CSS (Cloudflare CDN) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/css/bootstrap.min.css"
      integrity="sha512-T584yQ/tdRR5QwOpfvDfVQUidzfgc2339Lc8uBDtcp/wYu80d7jwBgAxbyMh0a9YM9F8N3tdErpFI8iaGx6x5g=="
      crossorigin="anonymous" referrerpolicy="no-referrer">
<!-- jQuery (Cloudflare CDN) -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- Bootstrap Bundle JS (Cloudflare CDN) -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/js/bootstrap.min.js"
        integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>
    #myInput {
        background-image: url('https://free-png.ru/wp-content/uploads/2021/07/free-png.ru-44-700x700.png');
        background-size: 6%;
        background-position: 10px 12px;
        background-repeat: no-repeat;
        width: 100%;
        font-size: 16px;
        padding: 12px 20px 12px 50px;
        border: 1px solid #ddd;
        border-radius: 10px;
        margin-bottom: 12px;
    }

    td {
        margin-left: 8px;
        font-weight: normal;
        font-size: 110%;
        text-align: justify;
        margin-right: 3px;
        margin-top: 0px;
        text-indent: 6px;
        margin: 0px;
        padding-bottom: 1px;
        padding-left: 4px;
        padding-right: 4px;
        padding-top: 1px;
        color: #003300
    }

    a {
        cursor: pointer;
        font-size: 115%;
    }

    #filter-text:hover {
        text-decoration: underline;
        font-size: 122%;
    }

    #filter-form {
        display: none;
        padding: 50px;
    }

    .checkbox.style-e {
        display: inline-block;
        position: relative;
        padding-left: 50px;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .checkbox.style-e input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }

    .checkbox.style-e input:checked ~ .checkbox__checkmark {
        background-color: #f7cb15;
    }

    .checkbox.style-e input:checked ~ .checkbox__checkmark:after {
        left: 21px;
    }

    .checkbox.style-e:hover input ~ .checkbox__checkmark {
        background-color: #eee;
    }

    .checkbox.style-e:hover input:checked ~ .checkbox__checkmark {
        background-color: #f7cb15;
    }

    .checkbox.style-e .checkbox__checkmark {
        position: absolute;
        top: 1px;
        left: 0;
        height: 22px;
        width: 40px;
        background-color: #eee;
        transition: background-color 0.25s ease;
        border-radius: 11px;
    }

    .checkbox.style-e .checkbox__checkmark:after {
        content: "";
        position: absolute;
        left: 3px;
        top: 3px;
        width: 16px;
        height: 16px;
        display: block;
        background-color: #fff;
        border-radius: 50%;
        transition: left 0.25s ease;
    }

    .checkbox.style-e .checkbox__body {
        color: #333;
        line-height: 1.4;
        font-size: 16px;
        transition: color 0.25s ease;
    }

    .underline-one {
    {#color: #00bfff; /* Цвет обычной ссылки */#} position: relative;
        cursor: pointer;
        text-decoration: none; /* Убираем подчеркивание */
    }

    .underline-one:after {
        content: "";
        display: block;
        position: absolute;
        right: 0;
        bottom: -3px;
        width: 0;
        height: 2px; /* Высота линии */
        background-color: black; /* Цвет подчеркивания при исчезании линии*/
        transition: width 0.5s; /* Время эффекта */
    }

    .underline-one:hover:after {
        content: "";
        width: 100%;
        display: block;
        position: absolute;
        left: 0;
        bottom: -3px;
        height: 2px; /* Высота линии */
        background-color: red; /* Цвет подчеркивания при появлении линии*/
        transition: width 0.5s; /* Время эффекта */
    }

    a:hover {
        text-decoration: none;
    }

</style>
<div style="margin-top: 5%;" class="col-sm-12 col-md-6 col-lg-4" id="filter">
    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-right-circle" fill="currentColor"
         xmlns="http://www.w3.org/2000/svg" id="filter-text" onclick="changeFilterVisible()">
        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path fill-rule="evenodd"
              d="M7.646 11.354a.5.5 0 0 1 0-.708L10.293 8 7.646 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0z"/>
        <path fill-rule="evenodd" d="M4.5 8a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5z"/>
    </svg>
    <a class="underline-one" onclick="changeFilterVisible()"> Фильтры</a>
    <form id="filter-form">
        <br>
        <input name='theme' type="text" id="myInput" onkeyup="myFunction()" placeholder="Введите название темы..."
               maxlenght='100'>
        <br><br>
        <label class="checkbox style-e">
            <input type="checkbox" name="lesson_type" value="Ключевой урок"/>
            <div class="checkbox__checkmark"></div>
            <div class="checkbox__body">Ключевой урок</div>
        </label>
        <hr>
        <label class="checkbox style-e">
            <input type="checkbox" name="lesson_type" value="Новая тема"/>
            <div class="checkbox__checkmark"></div>
            <div class="checkbox__body">Новая тема</div>
        </label>
        <hr>
        <label class="checkbox style-e">
            <input type="checkbox" name="absent" value="absent"/>
            <div class="checkbox__checkmark"></div>
            <div class="checkbox__body">Урок который я пропустил</div>
        </label>
        <center style="padding-top: 25px;">
            <input type="submit" value="Найти" class="btn btn-outline-dark" style="width: 50%; margin-top: 5%;"><br>
            <small><a href='{% url 'schedule' %}' style="color: blue;">Сбросить фильтры</a></small>
        </center>
        <br>
        <center>
            <label><a class="underline-one" href="{% url 'download_report' schedules.first.group.pk %}">Создать
                отчёт</a></label>
        </center>
        {% if request.user.is_staff %}
            <br>
            <center>
                <label><a class="underline-one" href="{% url 'get_training_program' %}">Получить
                    программу курса</a></label>
            </center>
        {% endif %}
    </form>
</div>

<p style="margin-top: 5%;">
    <label class="alert-danger">Красный фон</label> - означает что вы не присутствовали на <label id="super-button"
                                                                                                  onclick="superButtonMagic()">уроке</label>
</p>

<p><label style="text-size: 115%; text-weight: bold;" class="alert-primary">
    <strong>Стилем </strong></label>- будут выделены темы уроков с ключевыми темами
</p>

<p>
    <label class="alert-warning">Жёлтый фон</label> - означает что была пройдена новая тема
</p>

<!-- Button trigger modal -->
<div style="margin: 1%;">
    <label class="float-lg-right float-md-right">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-right-text"
             viewBox="0 0 16 16">
            <path d="M2 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9.586a2 2 0 0 1 1.414.586l2 2V2a1 1 0 0 0-1-1H2zm12-1a2 2 0 0 1 2 2v12.793a.5.5 0 0 1-.854.353l-2.853-2.853a1 1 0 0 0-.707-.293H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h12z"/>
            <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
        </svg>
        <a data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">Задать анонимный вопрос</a>
    </label>
</div>

<!-- Modal -->

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Задать анонимный вопрос</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Тут вы можете что-то спросить/уточнить у своего учителя. Все вопросы будут отправлены анонимно. <br>
                    <i>К примеру, вы можете попросить учителя ещё раз объяснить тему ООП, т. к. вы её не поняли</i></p>
                <form action="{% url 'ask_question' %}">
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Ваш вопрос:</label>
                        <textarea class="form-control" id="message-text" name="question"></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">
                            Закрыть
                        </button>
                        <input type="button" class="btn btn-primary" value="Отправить вопрос" onclick="ask_question()">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<table class="table table-hover table-bordered" style="margin-top: 1%;">
    <thead>
    <tr>
        <th scope="col">#</th>
        <th scope="col">Тема урока</th>
        <th scope="col">Время занятия</th>
        <th scope="col">Материалы к уроку</th>
    </tr>
    </thead>
    <tbody>
    {% for schedule in schedules %}
        {% if schedule.is_display %}
            <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td
                        {% for i in schedule.absent.all %}{% if user.get_username == i.name %}class='alert-danger'
                        title="Вы не присутствовали на этом уроке"{% endif %}{% endfor %}{% if schedule.key_topic %}
                        class="alert-primary" style="font-size: 115%; font-weight: bold;"{% endif %}
                        {% if schedule.lesson_type == 'Новая тема' %} class="alert-warning"
                        {% elif schedule.lesson_type == 'Ключевой урок' %} class="alert-primary"
                        {% endif %}
                        title="Это {{ schedule.lesson_type }}"
                >{{ schedule.theme | safe }}</td>
                <td style="width: 20%;">{{ schedule.weekday }} {{ schedule.time_lesson }}</td>
                <td style="width: 50%;">{{ schedule.lesson_materials | safe }}</td>
            </tr>
        {% endif %}
    {% endfor %}
    </tbody>
</table>
<nav aria-label="Page navigation example">
    {% if is_paginated %}
        {% if page_obj.has_other_pages %}
            <style>
                #pag {
                    margin-top: 75px;
                    height: 100%;
                }
            </style>
            <nav aria-label="Navigation panel" id="pag">
                <ul class="pagination justify-content-center">

                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" tabindex="-1">Предыдущая
                                страница</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Предыдущая страница</a>
                        </li>
                    {% endif %}
                    {% for p in page_obj.paginator.page_range %}

                        {% if forloop.first and p < page_obj.number|add:-3 %}
                            <li class="page-item"><a class="page-link" href="?page=1">1</a>
                            <li class="page-item"><a class="page-link">...</a></li>
                        {% endif %}

                        {% if p >= page_obj.number|add:-3 and p <= page_obj.number|add:3 %}
                            <li class="page-item{% if p != page_obj.number %}{% else %} active{% endif %}"><a
                                    class="page-link"
                                    href="?page={{ p }}">{{ p }}</a>
                            </li>

                        {% endif %}

                        {% if forloop.last and p > page_obj.number|add:3 %}
                            <li class="page-item"><a class="page-link">...</a></li>
                            <li class="page-item">
                            <a class="page-link" href="?page={{ paginator.num_pages }}">{{ paginator.num_pages }}</a>
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Следующая страница</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#">Следующая страница</a>
                        </li>
                    {% endif %}

                </ul>
            </nav>
        {% endif %}
    {% endif %}
</nav>
<script>
    function changeFilterVisible() {
        filter = document.getElementById('filter-form');
        if (getComputedStyle(filter).display === 'none') {
            filter.style.display = 'block';
        } else {
            filter.style.display = 'none';
        }
    }
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    function ask_question() {
        $.ajax({
            data:
                {
                    question: document.getElementById('message-text').value
                },
            url: "{% url 'ask_question' %}",

            success: function (response) {
                $('#exampleModal').modal('hide');
                if (response.is_taken === true) {
                    showMessage('Ваш вопрос успешно сохранён!', 'info')
                } else {
                    showMessage('Вы не ввели вопрос!', 'error')
                }
            },

            error: function (response) {
                showMessage('Вы не ввели вопрос!', 'error')
            }
        });
        return false;
    }
</script>


<script>
    function superButtonMagic() {
        // создаем AJAX-вызов
        $.ajax({
            data: $(this).serialize(), // получаяем данные формы
            url: "{% url 'get_filter_data' %}",
            // если успешно, то
            success: function (response) {
                if (response.code === 'OK') {
                    element = document.getElementById('super-button')
                    element.innerText = response.answer
                } else {
                    alert('Произошла ошибка!')
                }
            },
            // если ошибка, то
            error: function (response) {
                // предупредим об ошибке
                console.log(response.responseJSON.errors)
            }
        });
        return false;
    }

    function showMessage(text, code) {
        const ul = document.getElementById('messages-list')
        const li = document.createElement('li')
        const div = document.createElement('div')
        div.textContent = text
        div.classList = 'alert alert-' + code + ' msg fade show'
        div.role = 'alert'
        li.appendChild(div)
        ul.appendChild(li)
        fade_alerts()
    }
</script>


</body>
</html>